<!-- Created by Christian Laußmann in 2022 and 2023 at Heinrich-Heine-University Düsseldorf-->
<!-- Copyrigth (C) 2022, 2023 Christian Laußmann -->
<!DOCTYPE html>
<html lang="en">
<head>
    <title>GoodVotes!</title>
    <link rel="stylesheet" href="{{ url_for('static', filename= 'style.css') }}"/>
    <script src="{{ url_for('static', filename= 'jquery-3.6.0.min.js') }}"></script>
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename= 'img/logo.png') }}">
    {% block head %}
    {% endblock %}
</head>

<body>
<div class="title-bar">
    <a href="/"><img src="{{ url_for('static', filename= 'img/logo.png') }}"></a>
    <div class="search">
        <form action="/searchforelection" method="get">
            <input type="text" id="keyword" name="keyword" placeholder="Search..." class="searchentry">
        </form>
    </div>
    {% if user is defined and user.is_authenticated %}
        <button onclick="popup_user()" class="userbtn">{{ user.username }}</button>
    {% else %}
        <a href="/login">
            <button class="loginbtn">Login</button>
        </a>
    {% endif %}
</div>


<div class="sep"></div>

{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for category, message in messages %}
      <div class="alert {{category}}" role="alert">
        {{message}}
      </div>
    {% endfor %}
  {% endif %}
{% endwith %}

{% block content %}
{% endblock %}

<div class="sep"></div>
<div class="footer">
    <div class="sep"></div>
    <div class="center">
        <a href="{{config.GOODVOTES_IMPRINT_URL}}" style="color:lightgray">Impressum/Imprint</a>
        &nbsp;&nbsp;&nbsp;&nbsp;        
        <a href="{{config.GOODVOTES_PRIVACY_URL}}" style="color:lightgray">Datenschutz/Privacy</a> 
    </div>
</div>

<div class="blurred-background" id="blurred-background" style="display: none;"></div>

{% if user is defined and user.is_authenticated %}
    <div class="infowindow" id="userinfo-window" style="display: none;">
        <div class="infowindow-title">
            {{ user.name }} - {{ user.email }}
        </div>
        <button onclick="close_userinfo()" class="closebtn">X</button>
        <a href="/logout"><input type="submit" id="logoutbtn" value="Logout" class="logout-submitbtn"></a>
        <div class="window-content">
            <h2>See your registered elections:</h2>
            <ul>
                {% for e in user.elections %}
                    <li><a href="/details/{{ e.id }}">{{ e.title }}</a></li>
                {% endfor %}
            </ul>
            <br>
            <h2>Change Password:</h2>
            <form action="/changepasswd" method="post">
                <input type="password" id="passwd_old" name="passwd" style="width: 96%;" placeholder="Password"
                       class="textfield" required>
                <input type="password" id="passwd_new" name="new_passwd" style="width: 96%;" placeholder="New Password"
                       class="textfield" required>
                <input type="password" id="passwd_confirm" name="confirm_passwd" style="width: 96%;"
                       placeholder="Confirm New Password" class="textfield" required>
                <br><br>
                <input type="submit" id="logintbtn" value="Change Password" class="changepass-submitbtn">
            </form>
        </div>
    </div>
{% endif %}
</body>
{% block scripts %}
{% endblock %}

<script>
    function popup_user() {
        document.getElementById("blurred-background").style.display = "block";
        document.getElementById("userinfo-window").style.display = "block";
    }

    function close_userinfo() {
        document.getElementById("blurred-background").style.display = "none";
        document.getElementById("userinfo-window").style.display = "none";
    }
</script>
</html>